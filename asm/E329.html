<!DOCTYPE html>
<html>
<head>
<title>Everyone's a Wally: Routine at E329</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../everyonesawally.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="E2FC.html">E2FC</a>
</td>
<td class="up">Up: <a href="../maps/all.html#e329">Map</a></td>
<td class="next">
Next: <a href="E3D3.html">E3D3</a>
</td>
</tr>
</table>
<div class="description">E329: Routine at E329</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="ED2A.html">ED2A</a>, <a href="EFC7.html">EFC7</a>, <a href="F10E.html">F10E</a>, <a href="F177.html">F177</a> and <a href="F5F1.html">F5F1</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="e329"></span>E329</td>
<td class="instruction">LD A,($A838)</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=*<a href="A838.html">A838</a>-(*<span class="register">IY</span>+05)-0D.</td>
</tr>
<tr>
<td class="address-1"><span id="e32c"></span>E32C</td>
<td class="instruction">SUB (IY+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="e32f"></span>E32F</td>
<td class="instruction">SUB $0D</td>
</tr>
<tr>
<td class="address-1"><span id="e331"></span>E331</td>
<td class="instruction">CP $E6</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e333"></span>E333</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e334"></span>E334</td>
<td class="instruction">LD A,($A839)</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=*<a href="A839.html">A839</a>-(*<span class="register">IY</span>+0A)-1C.</td>
</tr>
<tr>
<td class="address-1"><span id="e337"></span>E337</td>
<td class="instruction">SUB (IY+$0A)</td>
</tr>
<tr>
<td class="address-1"><span id="e33a"></span>E33A</td>
<td class="instruction">SUB $1C</td>
</tr>
<tr>
<td class="address-1"><span id="e33c"></span>E33C</td>
<td class="instruction">CP $D6</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e33e"></span>E33E</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e33f"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="F177.html">F177</a>, <a href="F5F1.html">F5F1</a> and <a href="F8B9.html">F8B9</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="e33f"></span>E33F</td>
<td class="instruction">LD A,($B55F)</td>
<td class="comment-1" rowspan="3">Return if <a href="B55F.html">Flag_DemoMode</a> is not zero.</td>
</tr>
<tr>
<td class="address-1"><span id="e342"></span>E342</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="e343"></span>E343</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="e344"></span>E344</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Switch to the shadow registers.</td>
</tr>
<tr>
<td class="address-1"><span id="e345"></span>E345</td>
<td class="instruction">LD BC,$640A</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=640A.</td>
</tr>
<tr>
<td class="address-1"><span id="e348"></span>E348</td>
<td class="instruction">LD DE,$0101</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0101.</td>
</tr>
<tr>
<td class="address-1"><span id="e34b"></span>E34B</td>
<td class="instruction">LD HL,$6401</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=6401.</td>
</tr>
<tr>
<td class="address-1"><span id="e34e"></span>E34E</td>
<td class="instruction">CALL <a href="E3D3.html">PlayWaveSequence</a></td>
<td class="comment-1" rowspan="1">Call <a href="E3D3.html">PlayWaveSequence</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e351"></span>E351</td>
<td class="instruction">LD A,($F26E)</td>
<td class="comment-1" rowspan="5">*<span class="register">IY</span>+14-=*<a href="F177.html#f26e">F26E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e354"></span>E354</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="e355"></span>E355</td>
<td class="instruction">LD A,(IY+$14)</td>
</tr>
<tr>
<td class="address-1"><span id="e358"></span>E358</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="e359"></span>E359</td>
<td class="instruction">LD (IY+$14),A</td>
</tr>
<tr>
<td class="address-1"><span id="e35c"></span>E35C</td>
<td class="instruction">JR Z,<a href="E329.html#e362">$E362</a></td>
<td class="comment-1" rowspan="2">If *<span class="register">IY</span>+14 &lt;= 00 jump to <a href="E329.html#e362">E362</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e35e"></span>E35E</td>
<td class="instruction">JR C,<a href="E329.html#e362">$E362</a></td>
</tr>
<tr>
<td class="address-1"><span id="e360"></span>E360</td>
<td class="instruction">JR <a href="E329.html#e36c">$E36C</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="E329.html#e36c">E36C</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e362"></span>
<div class="comments">
<div class="paragraph">
A life has been "spent" so refill the endurance meter to the top.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="e362"></span>E362</td>
<td class="instruction">LD (IY+$14),$80</td>
<td class="comment-1" rowspan="1">Write 80 to *<span class="register">IY</span>+14.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e366"></span>
<div class="comments">
<div class="paragraph">
Lose one heart...
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="e366"></span>E366</td>
<td class="instruction">DEC (IY+$2D)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IY</span>+2D by one.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e369"></span>
<div class="comments">
<div class="paragraph">
If the players hearts are now zero the game is over.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="e369"></span>E369</td>
<td class="instruction">JP Z,<a href="B451.html">GameOver</a></td>
<td class="comment-1" rowspan="1">If current players hearts (*<span class="register">IY</span>+2D) are now zero jump to <a href="B451.html">GameOver</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="e36c"></span>E36C</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Switch back to the normal registers.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e36d"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="E3FD.html">PrintBanner</a> and <a href="F814.html">F814</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="e36d"></span>E36D</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Switch to the shadow registers.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e36e"></span>
<div class="comments">
<div class="paragraph">
Draw the hearts to indicate the number of lives remaining.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="e36e"></span>E36E</td>
<td class="instruction">LD C,$46</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=46 (INK:
YELLOW,
PAPER:
BLACK
(BRIGHT)
).</td>
</tr>
<tr>
<td class="address-1"><span id="e370"></span>E370</td>
<td class="instruction">LD HL,$DFDC</td>
<td class="comment-1" rowspan="2">Write <a href="D1BC.html#dfdc">Font</a> to <a href="B7BA.html#b7e8">B7E9</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e373"></span>E373</td>
<td class="instruction">LD ($B7E9),HL</td>
</tr>
<tr>
<td class="address-1"><span id="e376"></span>E376</td>
<td class="instruction">LD DE,$021C</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=021C (screen co-ordinates).</td>
</tr>
<tr>
<td class="address-1"><span id="e379"></span>E379</td>
<td class="instruction">LD L,(IY+$2D)</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=*<span class="register">IY</span>+2D (current players hearts).</td>
</tr>
<tr>
<td class="address-1"><span id="e37c"></span>E37C</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="address-1"><span id="e37d"></span>E37D</td>
<td class="instruction">LD B,$02</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=02 (counter).</td>
</tr>
<tr>
<td class="address-2"><span id="e37f"></span>E37F</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e380"></span>E380</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e381"></span>E381</td>
<td class="instruction">LD A,$1F</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="D1BC.html#e0d4">1F</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e383"></span>E383</td>
<td class="instruction">JR NZ,<a href="E329.html#e386">$E386</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e385"></span>E385</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="e386"></span>E386</td>
<td class="instruction">CALL <a href="B7BA.html">DrawSprite</a></td>
<td class="comment-1" rowspan="1">Call <a href="B7BA.html">DrawSprite</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e389"></span>E389</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="2">Increment <span class="register">E</span> by two.</td>
</tr>
<tr>
<td class="address-1"><span id="e38a"></span>E38A</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address-1"><span id="e38b"></span>E38B</td>
<td class="instruction">CP $20</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e38d"></span>E38D</td>
<td class="instruction">JR Z,<a href="E329.html#e390">$E390</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e38f"></span>E38F</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="e390"></span>E390</td>
<td class="instruction">DJNZ <a href="E329.html#e37f">$E37F</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e392"></span>
<div class="comments">
<div class="paragraph">
Draws the endurance ribbon.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="e392"></span>E392</td>
<td class="instruction">LD C,$43</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=43 (INK:
MAGENTA,
PAPER:
BLACK
(BRIGHT)
).</td>
</tr>
<tr>
<td class="address-1"><span id="e394"></span>E394</td>
<td class="instruction">LD DE,$0310</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0310.</td>
</tr>
<tr>
<td class="address-1"><span id="e397"></span>E397</td>
<td class="instruction">LD L,$5C</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=<a href="D1BC.html#e2bc">5C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e399"></span>E399</td>
<td class="instruction">LD B,(IY+$14)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IY</span>+14.</td>
</tr>
<tr>
<td class="address-2"><span id="e39c"></span>E39C</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e39d"></span>E39D</td>
<td class="instruction">SUB $08</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e39f"></span>E39F</td>
<td class="instruction">JR C,<a href="E329.html#e3bc">$E3BC</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3a1"></span>E3A1</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3a2"></span>E3A2</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3a3"></span>E3A3</td>
<td class="instruction">CALL <a href="B7BA.html">DrawSprite</a></td>
<td class="comment-1" rowspan="1">Call <a href="B7BA.html">DrawSprite</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e3a6"></span>E3A6</td>
<td class="instruction">XOR $01</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3a8"></span>E3A8</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3a9"></span>E3A9</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3aa"></span>E3AA</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3ab"></span>E3AB</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3ac"></span>E3AC</td>
<td class="instruction">JR NZ,<a href="E329.html#e39c">$E39C</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="e3ae"></span>E3AE</td>
<td class="instruction">BIT 5,E</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3b0"></span>E3B0</td>
<td class="instruction">JR Z,<a href="E329.html#e3b4">$E3B4</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3b2"></span>E3B2</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Switch back to the normal registers.</td>
</tr>
<tr>
<td class="address-1"><span id="e3b3"></span>E3B3</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="e3b4"></span>E3B4</td>
<td class="instruction">LD A,$20</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=20.</td>
</tr>
<tr>
<td class="address-1"><span id="e3b6"></span>E3B6</td>
<td class="instruction">CALL <a href="B7BA.html">DrawSprite</a></td>
<td class="comment-1" rowspan="1">Call <a href="B7BA.html">DrawSprite</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e3b9"></span>E3B9</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Increment <span class="register">E</span> by one.</td>
</tr>
<tr>
<td class="address-1"><span id="e3ba"></span>E3BA</td>
<td class="instruction">JR <a href="E329.html#e3ae">$E3AE</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="E329.html#e3ae">E3AE</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="e3bc"></span>E3BC</td>
<td class="instruction">ADD A,$08</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=08.</td>
</tr>
<tr>
<td class="address-1"><span id="e3be"></span>E3BE</td>
<td class="instruction">SRL A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3c0"></span>E3C0</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3c1"></span>E3C1</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3c2"></span>E3C2</td>
<td class="instruction">CP $5C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3c4"></span>E3C4</td>
<td class="instruction">JR NZ,<a href="E329.html#e3ca">$E3CA</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="e3c6"></span>E3C6</td>
<td class="instruction">LD A,$5D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=5D.</td>
</tr>
<tr>
<td class="address-1"><span id="e3c8"></span>E3C8</td>
<td class="instruction">JR <a href="E329.html#e3cc">$E3CC</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="E329.html#e3cc">E3CC</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="e3ca"></span>E3CA</td>
<td class="instruction">LD A,$60</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=60.</td>
</tr>
<tr>
<td class="address-2"><span id="e3cc"></span>E3CC</td>
<td class="instruction">ADD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="e3cd"></span>E3CD</td>
<td class="instruction">CALL <a href="B7BA.html">DrawSprite</a></td>
<td class="comment-1" rowspan="1">Call <a href="B7BA.html">DrawSprite</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="e3d0"></span>E3D0</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Increment <span class="register">E</span> by one.</td>
</tr>
<tr>
<td class="address-1"><span id="e3d1"></span>E3D1</td>
<td class="instruction">JR <a href="E329.html#e3ae">$E3AE</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="E329.html#e3ae">E3AE</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="E2FC.html">E2FC</a>
</td>
<td class="up">Up: <a href="../maps/all.html#e329">Map</a></td>
<td class="next">
Next: <a href="E3D3.html">E3D3</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1985 Mikro-Gen &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/everyonesawally/">Source code</a>.</div>
<div><a href="../dec/asm/58153.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>