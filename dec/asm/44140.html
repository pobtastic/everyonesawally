<!DOCTYPE html>
<html>
<head>
<title>Everyone's a Wally: Routine at 44140</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../everyonesawally.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="44137.html">44137</a>
</td>
<td class="up">Up: <a href="../maps/all.html#44140">Map</a></td>
<td class="next">
Next: <a href="44159.html">44159</a>
</td>
</tr>
</table>
<div class="description">44140: Find Data By ID</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="43660.html">43660</a>, <a href="47726.html">Handler_DisplayCharacterLocation</a> and <a href="60095.html">60095</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">ID of data to find</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to data for searching</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to data correlating to the ID</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44140"></span>
<div class="comments">
<div class="paragraph">
If <span class="register">A</span> is zero, just return instantly.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">FindDataById</td>
<td class="address-2"><span id="44140"></span>44140</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Return if <span class="register">A</span> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44141"></span>44141</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44142"></span>44142</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash <span class="register">BC</span> and <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44143"></span>44143</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44144"></span>
<div class="comments">
<div class="paragraph">
<span class="register">E</span> now holds the ID we want to find the memory location for. This is used as a "countdown".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44144"></span>44144</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44145"></span>
<div class="comments">
<div class="paragraph">
All data is terminated by 255 so essentially we're going to count how many terminators we find. This will give us the start address of the data ID we're interested in.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44145"></span>44145</td>
<td class="instruction">LD A,255</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=255.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44147"></span>
<div class="comments">
<div class="paragraph">
Set the counter to 65536.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44147"></span>44147</td>
<td class="instruction">LD BC,0</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0000.</td>
</tr>
<tr>
<td class="asm-label">FindDataById_Loop</td>
<td class="address-2"><span id="44150"></span>44150</td>
<td class="instruction">CPIR</td>
<td class="comment-1" rowspan="1">Search for the first occurrence of 255 using *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44152"></span>
<div class="comments">
<div class="paragraph">
Move onto the next ID, and keep looping back to <a href="44140.html#44150">FindDataById_Loop</a> until we're on the ID we want to find the data for.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44152"></span>44152</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">E</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44153"></span>44153</td>
<td class="instruction">JP NZ,<a href="44140.html#44150">FindDataById_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="44140.html#44150">FindDataById_Loop</a> until <span class="register">E</span> is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44156"></span>
<div class="comments">
<div class="paragraph">
Once we're here, <span class="register">HL</span> will contain the start address of the data correlating to the given ID.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44156"></span>44156</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="2">Restore <span class="register">DE</span> and <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44157"></span>44157</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="44158"></span>44158</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="44137.html">44137</a>
</td>
<td class="up">Up: <a href="../maps/all.html#44140">Map</a></td>
<td class="next">
Next: <a href="44159.html">44159</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1985 Mikro-Gen &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/everyonesawally/">Source code</a>.</div>
<div><a href="../../asm/AC6C.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>